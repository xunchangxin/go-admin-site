(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{200:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this.$createElement;this._self._c;return this._m(0)}),[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"环境部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境部署"}},[s._v("#")]),s._v(" 环境部署")]),s._v(" "),t("h2",{attrs:{id:"nginx-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[s._v("#")]),s._v(" nginx 配置")]),s._v(" "),t("p",[s._v("配置服务器上的配置")]),s._v(" "),t("p",[s._v("新建/etc/nginx/conf.d/test.haimait.com.conf")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  server_name test.haimait.com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置前端静态文件目录")]),s._v("\n  location / "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      index index.html index.htm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      root /home/go/src/go-admin/dist"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置后台go服务api接口服务 代理到8877端口")]),s._v("\n  location ~ ^/goadminapi/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      proxy_set_header   Host             "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_set_header   X-Real-IP        "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_set_header   X-Forwarded-For  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_set_header   X-Forwarded-Proto  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      rewrite ^/goadminapi/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_pass  http://127.0.0.1:8877"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("nginx -t"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" //测试nginx配置是否正确\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("nginx -s reload"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" //重启nginx服务\n")])])]),t("h2",{attrs:{id:"打包-go-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包-go-服务"}},[s._v("#")]),s._v(" 打包 go 服务")]),s._v(" "),t("h4",{attrs:{id:"修改配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),t("p",[s._v("修改"),t("code",[s._v("go-admin/config/settings.yml")])]),s._v(" "),t("p",[t("strong",[s._v("这里要填写你服务器上的 mysql 数据库的配置信息")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("settings:\n  application:\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dev开发环境 test测试环境 prod线上环境")]),s._v("\n    mode: dev\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器ip，默认使用 0.0.0.0")]),s._v("\n    host: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务名称")]),s._v("\n    name: testApp\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口号")]),s._v("\n    port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务端口号")]),s._v("\n    readtimeout: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    writertimeout: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据权限功能开关")]),s._v("\n    enabledp: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  logger:\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志存放路径")]),s._v("\n    path: temp/logs\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 控制台日志")]),s._v("\n    stdout: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志等级")]),s._v("\n    level: all\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 业务日志开关")]),s._v("\n    enabledbus: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求日志开关")]),s._v("\n    enabledreq: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据库日志开关 dev模式，将自动开启")]),s._v("\n    enableddb: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  jwt:\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# token 密钥，【特别注意：生产环境时及的修改】")]),s._v("\n    secret: go-admin\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# token 过期时间 单位：秒")]),s._v("\n    timeout: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v("\n  database:\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据库类型 mysql，sqlite3， postgres")]),s._v("\n    driver: mysql\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据库连接字符串 mysql 缺省信息 charset=utf8&parseTime=True&loc=Local&timeout=1000ms")]),s._v("\n    source: user:password@tcp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:3306"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/dbname?charset"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("parseTime")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("True"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("loc")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1000ms\n  gen:\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代码生成读取的数据库名称")]),s._v("\n    dbname: dbname\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 代码生成是使用前端代码存放位置，需要指定到src文件夹，相对路径")]),s._v("\n    frontpath: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/go-admin-ui/src\n")])])]),t("h4",{attrs:{id:"修改默认端口的代码文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改默认端口的代码文件"}},[s._v("#")]),s._v(" 修改默认端口的代码文件")]),s._v(" "),t("h4",{attrs:{id:"编写自动打包上传的-shell-角本文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写自动打包上传的-shell-角本文件"}},[s._v("#")]),s._v(" 编写自动打包上传的 shell 角本文件")]),s._v(" "),t("h5",{attrs:{id:"新建打包角本-go-admin-build-go-admin-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新建打包角本-go-admin-build-go-admin-sh"}},[s._v("#")]),s._v(" 新建打包角本 "),t("code",[s._v("go-admin/build-go-admin.sh")])]),s._v(" "),t("p",[t("strong",[s._v("注意")]),s._v("\n如果是 mac 和 windows 自己百度 go 交叉编译的方法或者参考下面的地址")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/haima/p/12041833.html",target:"_blank"}},[s._v("Go 语言 Mac、Linux、Windows 下交叉编译")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# !/bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果是mac使用这个打包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o go-admin main.go")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果是windows使用这个打包 自行测试")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SET CGO_ENABLED=0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SET GOOS=linux")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SET GOARCH=amd64")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go build -o go-admin main.go")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果是linux环境使用这个打包")]),s._v("\ngo build -o go-admin main.go\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"复制文件到服务器"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build main.go"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#调用上传文件角本把打包好的go-admin二进制文件上传到服务器上")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" ./scpToServer.sh "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$j")]),s._v("\n")])])]),t("h5",{attrs:{id:"新建上传角本-go-admin-scptoserver-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新建上传角本-go-admin-scptoserver-sh"}},[s._v("#")]),s._v(" 新建上传角本 "),t("code",[s._v("/go-admin/scpToServer.sh")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/expect -f")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制go-admin(和上面的build-go-admin.sh打包文件名保持一致)二进制文件到服务器/home/go/src/go-admin目录 root:服务器用户名")]),s._v("\nspawn "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" go-admin root@182.92.234.123:/home/go/src/go-admin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#######################")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  -re "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*es.*o.*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    exp_send "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yes'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('"')]),s._v("\n    exp_continue\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  -re "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*sword.*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    exp_send "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这里是你的服务器密码'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ninteract\n")])])]),t("h4",{attrs:{id:"打包并上传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包并上传"}},[s._v("#")]),s._v(" 打包并上传")]),s._v(" "),t("p",[s._v("​\n命令行里运行")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" go-admin\nhaima@haima-PC:/media/haima/34E401CC64DD0E28/site/go/src/haimait/learn/go-admin/dome01/go-admin$ ./build-go-admin.sh\nspawn "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" go-admin root@182.92.234.111:/home/go/src/go-admin\nroot@182.92.234.111's password:\ngo-admin                                                                                                                                                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("%   43MB "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("635")]),s._v(".7KB/s   01:09\n")])])]),t("p",[s._v("去服务器上查看已经上传到服务器上了")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZ2ze505h9bgsbp83ct28pZ ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /home/go/src/go-admin/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZ2ze505h9bgsbp83ct28pZ go-admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\n总用量 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43868")]),s._v("\n-rwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44920528")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("月   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" 06:53 go-admin\n")])])]),t("a",{attrs:{href:"https://gitee.com/mydearzwj/image/raw/master/img/bs1.gif",target:"_blank"}},[t("img",{attrs:{src:"https://gitee.com/mydearzwj/image/raw/master/img/bs1.gif",alt:"",width:"100%"}})]),s._v(" "),t("h4",{attrs:{id:"编写后台启动-go-服务角本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写后台启动-go-服务角本"}},[s._v("#")]),s._v(" 编写后台启动 go 服务角本")]),s._v(" "),t("h5",{attrs:{id:"在服务器上新建-go-admin-restart-sh-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在服务器上新建-go-admin-restart-sh-文件"}},[s._v("#")]),s._v(" 在服务器上新建 go-admin/restart.sh 文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"删除进程"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("killall")]),s._v(" go-admin "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#杀死运行中的go-admin服务进程")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动进程"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./go-admin server -c"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("config/settings.yml "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" access.log "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#后台启动服务将日志写入access.log文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -aux "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" go-admin "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看运行用的进程")]),s._v("\n")])])]),t("h5",{attrs:{id:"上传-config-配置到服务器上"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#上传-config-配置到服务器上"}},[s._v("#")]),s._v(" 上传 config 配置到服务器上")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZ2ze505h9bgsbp83ct28pZ go-admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n├── config\n│ ├── db.sql "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 系统初始化配置不建议上传服务器")]),s._v("\n│ ├── rbac_model.conf\n│ ├── READMEN.md\n│ ├── settings.dev.yml "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试环境配置不建议上传服务器")]),s._v("\n│ ├── settings.yml\n│ └── sqlite.sql "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 系统初始化配置不建议上传服务器")]),s._v("\n├── go-admin\n└── restart.sh\n")])])]),t("h5",{attrs:{id:"启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动服务"}},[s._v("#")]),s._v(" 启动服务")]),s._v(" "),t("p",[t("code",[s._v("./restart")])]),s._v(" "),t("h5",{attrs:{id:"后台启动服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#后台启动服务"}},[s._v("#")]),s._v(" 后台启动服务")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZ2ze505h9bgsbp83ct28pZ go-admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./restart.sh")]),s._v("\n删除进程\ngo-admin: 未找到进程\n启动进程\nroot      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4033")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12324")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1080")]),s._v(" pts/0    R+   07:39   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" go-admin\n")])])]),t("h4",{attrs:{id:"查看启动的服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看启动的服务"}},[s._v("#")]),s._v(" 查看启动的服务")]),s._v(" "),t("p",[s._v("下面可以看到 go-admin 的 8877 服务已经运行")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZ2ze505h9bgsbp83ct28pZ go-admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -tpln")]),s._v("\nActive Internet connections "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("only servers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27650")]),s._v("/redis-server\ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:5355            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("921")]),s._v("/systemd-resolve\ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1733")]),s._v("/nginx: master\ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:22              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1041")]),s._v("/sshd\ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::3306                 :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14732")]),s._v("/mysqld\ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::8811                 :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27758")]),s._v("/./mindoc\ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::5355                 :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("921")]),s._v("/systemd-resolve\ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::8877                 :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4031")]),s._v("/./go-admin\ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::80                   :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1733")]),s._v("/nginx: master\ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::8887                 :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16252")]),s._v("/./power\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@iZ2ze505h9bgsbp83ct28pZ go-admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])])]),t("h4",{attrs:{id:"更新-go-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新-go-服务"}},[s._v("#")]),s._v(" 更新 go 服务")]),s._v(" "),t("p",[s._v("每次修改来代码后,想要更新到服务器上步骤.")]),s._v(" "),t("h5",{attrs:{id:"先删除服务器上的-home-go-src-go-admin-go-admin-二进制文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#先删除服务器上的-home-go-src-go-admin-go-admin-二进制文件"}},[s._v("#")]),s._v(" 先删除服务器上的/home/go/src/go-admin/go-admin 二进制文件")]),s._v(" "),t("h5",{attrs:{id:"重复-3-4-和-3-5-步骤即可"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重复-3-4-和-3-5-步骤即可"}},[s._v("#")]),s._v(" 重复 3.4 和 3.5 步骤即可")]),s._v(" "),t("h3",{attrs:{id:"打包前端文件并上传"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包前端文件并上传"}},[s._v("#")]),s._v(" 打包前端文件并上传")]),s._v(" "),t("h3",{attrs:{id:"修改配置文件-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件-2"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),t("p",[s._v("修改生产环境请求接口的配置文件")]),s._v(" "),t("p",[s._v("修改"),t("code",[s._v("go-admin/dome01/go-admin-ui/.env.production")]),s._v("文件里的")]),s._v(" "),t("p",[t("code",[s._v("VUE_APP_BASE_API = 'http://test.haimait.com/goadminapi'")])]),s._v(" "),t("p",[s._v("这里的域名地址和 1.2nginx 里配置的 go 后台 api 接口地址 保持一致")]),s._v(" "),t("h3",{attrs:{id:"编写自动打包上传的-shell-角本文件-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写自动打包上传的-shell-角本文件-2"}},[s._v("#")]),s._v(" 编写自动打包上传的 shell 角本文件")]),s._v(" "),t("h5",{attrs:{id:"新建-go-admin-ui-npmbuild-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新建-go-admin-ui-npmbuild-sh"}},[s._v("#")]),s._v(" 新建"),t("code",[s._v("/go-admin-ui/npmbuild.sh")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# !/bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build:prod\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"复制dist文件到服务器"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#调用scpToServer文件把本把打包好的dist文件夹上传到服务器上")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" ./scpToServer.sh "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$j")]),s._v("\n")])])]),t("h5",{attrs:{id:"新建-go-admin-ui-scptoserver-sh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新建-go-admin-ui-scptoserver-sh"}},[s._v("#")]),s._v(" 新建"),t("code",[s._v("/go-admin-ui/scpToServer.sh")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/expect -f")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制go-admin(和上面的build-go-admin.sh打包文件名保持一致)二进制文件到服务器/home/go/src/go-admin目录 root:服务器用户名")]),s._v("\nspawn "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" -rC dist root@182.92.234.123:/home/go/src/go-admin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#######################")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  -re "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*es.*o.*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    exp_send "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yes'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('"')]),s._v("\n    exp_continue\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  -re "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('".*sword.*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#exp_send "这里是你的服务器密码\\r"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\ninteract\n")])])]),t("h3",{attrs:{id:"执行角本文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行角本文件"}},[s._v("#")]),s._v(" 执行角本文件")]),s._v(" "),t("p",[s._v("执行角本文件,打包并上传到服务器")]),s._v(" "),t("p",[t("code",[s._v("./npmbuild.sh")])]),s._v(" "),t("h3",{attrs:{id:"登陆后台页面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登陆后台页面"}},[s._v("#")]),s._v(" 登陆后台页面")]),s._v(" "),t("p",[s._v("http://www.zhangwj.com")]),s._v(" "),t("p",[s._v("已经成功部署到线上了")]),s._v(" "),t("h3",{attrs:{id:"更新前端代码到服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新前端代码到服务器"}},[s._v("#")]),s._v(" 更新前端代码到服务器")]),s._v(" "),t("p",[s._v("重复【执行角本文件】步骤,就会重新打包并覆盖到线上的 dist 目录文件了")]),s._v(" "),t("a",{attrs:{href:"https://gitee.com/mydearzwj/image/raw/master/img/bs2.gif",target:"_blank"}},[t("img",{attrs:{src:"https://gitee.com/mydearzwj/image/raw/master/img/bs2.gif",alt:"",width:"100%"}})]),s._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("特别感谢 海马同学 的支持，对文档的维护起到了至关重要的角色")])])])}],!1,null,null,null);a.default=e.exports}}]);